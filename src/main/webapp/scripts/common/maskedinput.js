(function(b){function s(a){var e={begin:0,end:0};a.setSelectionRange?(e.begin=a.selectionStart,e.end=a.selectionEnd):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),e.begin=0-a.duplicate().moveStart("character",-1E5),e.end=e.begin+a.text.length);return e}function l(a,e){if(a.setSelectionRange)a.focus(),a.setSelectionRange(e,e);else if(a.createTextRange){var b=a.createTextRange();b.collapse(!0);b.moveEnd("character",e);b.moveStart("character",e);b.select()}}var p={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"};b.mask={addPlaceholder:function(a,e){p[a]=e}};b.fn.unmask=function(){return this.trigger("unmask")};b.fn.mask=function(a,e){for(var e=b.extend({placeholder:"_",completed:null},e),m="^",h=0;h<a.length;h++)m+=p[a.charAt(h)]||"\\"+a.charAt(h);var u=RegExp(m+"$");return this.each(function(){function h(){n();i();setTimeout(function(){l(f[0],0)},0)}function m(c){var d=s(this),c=c.keyCode;q=16>c||16<c&&32>c||32<c&&41>c;0!=d.begin-d.end&&(!q||8==c||46==c)&&r(d.begin,d.end);if(8==c)for(;0<=d.begin--;){if(!o[d.begin])return j[d.begin]=e.placeholder,b.browser.opera?(i(d.begin),l(this,d.begin+1)):(i(),l(this,d.begin)),!1}else{if(46==c)return r(d.begin,d.begin+1),i(),l(this,d.begin),!1;if(27==c)return r(0,a.length),i(),l(this,0),!1}}function t(c){if(q)q=!1;else{var c=c||window.event,d=c.charCode||c.keyCode||c.which,g=s(this),b=g.begin;if(c.ctrlKey||c.altKey)return!0;if(41<=d&&122>=d||32==d||186<d)for(;g.begin<a.length;)if(c=p[a.charAt(g.begin)]){c=RegExp(c);if(c=String.fromCharCode(d).match(c))j[g.begin]=String.fromCharCode(d);else return!1;for(;++b<a.length&&o[b];);break}else g.begin+=1,g.end=g.begin,b+=1;else return!1;i();e.completed&&b>=j.length?e.completed.call(f):l(this,b);return!1}}function r(c,d){for(var a=c;a<d;a++)o[a]||(j[a]=e.placeholder)}function i(c){for(var d="",b=0;b<a.length;b++)d+=j[b],b==c&&(d+=e.placeholder);f.val(d);return d}function n(){for(var c=f.val(),d=0,b=0;b<a.length;b++)if(!o[b])for(;d++<c.length;){var e=RegExp(p[a.charAt(b)]);if(c.charAt(d-1).match(e)){j[b]=c.charAt(d-1);break}}i().match(u)||(f.val(""),r(0,a.length))}for(var f=b(this),j=Array(a.length),o=Array(a.length),k=0;k<a.length;k++)o[k]=null==p[a.charAt(k)],j[k]=o[k]?a.charAt(k):e.placeholder;f.bind("focus",h);f.bind("blur",n);b.browser.msie?this.onpaste=function(){setTimeout(n,0)}:b.browser.mozilla&&this.addEventListener("input",n,!1);var q=!1;f.bind("keydown",m);f.bind("keypress",t);f.one("unmask",function(){f.unbind("focus",h);f.unbind("blur",n);f.unbind("keydown",m);f.unbind("keypress",t);b.browser.msie?this.onpaste=null:b.browser.mozilla&&this.removeEventListener("input",n,!1)})})}})(jQuery);